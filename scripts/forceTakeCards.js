const { ethers, upgrades } = require("hardhat");
const getNamedAccount = require("./DEPLOYMENTS.js")

async function main(cards) {
  const [admin] = await ethers.getSigners();
  console.log("Admin: ", admin);

  const Arena = await ethers.getContractFactory("Arena");
  const arenaProxy = getNamedAccount("arenaProxy");
  const arenaContract = Arena.attach(arenaProxy)

  const mcall = "0xcA11bde05977b3631167028862bE2a173976CA11";
  const mcallabi = [
    "function aggregate(tuple(address target, bytes callData)[] calls) payable returns (uint256 blockNumber, bytes[] returnData)",
    "function aggregate3(tuple(address target, bool allowFailure, bytes callData)[] calls) payable returns (tuple(bool success, bytes returnData)[] returnData)",
    "function aggregate3Value(tuple(address target, bool allowFailure, uint256 value, bytes callData)[] calls) payable returns (tuple(bool success, bytes returnData)[] returnData)",
    "function blockAndAggregate(tuple(address target, bytes callData)[] calls) payable returns (uint256 blockNumber, bytes32 blockHash, tuple(bool success, bytes returnData)[] returnData)",
    "function getBasefee() view returns (uint256 basefee)",
    "function getBlockHash(uint256 blockNumber) view returns (bytes32 blockHash)",
    "function getBlockNumber() view returns (uint256 blockNumber)",
    "function getChainId() view returns (uint256 chainid)",
    "function getCurrentBlockCoinbase() view returns (address coinbase)",
    "function getCurrentBlockDifficulty() view returns (uint256 difficulty)",
    "function getCurrentBlockGasLimit() view returns (uint256 gaslimit)",
    "function getCurrentBlockTimestamp() view returns (uint256 timestamp)",
    "function getEthBalance(address addr) view returns (uint256 balance)",
    "function getLastBlockHash() view returns (bytes32 blockHash)",
    "function tryAggregate(bool requireSuccess, tuple(address target, bytes callData)[] calls) payable returns (tuple(bool success, bytes returnData)[] returnData)",
    "function tryBlockAndAggregate(bool requireSuccess, tuple(address target, bytes callData)[] calls) payable returns (uint256 blockNumber, bytes32 blockHash, tuple(bool success, bytes returnData)[] returnData)",
  ]

  const mcallContract = new ethers.Contract(mcall, mcallabi, admin)
  let pos = 720;
  const batchSize = 120;
  let agg = [];

  let currentNonce = await ethers.provider.getTransactionCount(admin.address)
  console.log("Admin's nonce", currentNonce)
  while (pos < cards.length) {
    for (let i = 0; i < batchSize && pos + i < cards.length; ++i) {
        const txData = await arenaContract.populateTransaction.takeCard(cards[i + pos], {gasLimit: 10000, gasPrice: 10000, nonce: 0});
        agg.push([arenaProxy, true, txData.data])
    }
    console.log("Sending batch...", agg.length)
    const tx = await mcallContract.aggregate3(agg, { nonce: currentNonce })
    currentNonce += 1
    console.log(tx.hash)
    await tx.wait()
    agg = []
    pos += batchSize;
  }
}

/*
List of cards is compued like:

with tokens_on_arena as (select token_id from polygon.nft_owners
where contract_address = '0x3D9e6bD43aC6afc78f3D8C8df6811D9aB53678c1' and
      owner_address = '0x24c6f0C81Cc8E6fc9348Fb3ab5338F903A5B7959')

select * from tokens_on_arena
order by token_id desc;

using transpose.io.

It contains some cards which are in progress,
by design it is impossible to remove them,
so it is safe. Yes, we are paying some extra costs
for trying, but SQL is simpler on the other hand.
*/

main([
  57867,
  57866,
  57853,
  57841,
  57759,
  57758,
  57735,
  57734,
  57726,
  57716,
  57715,
  57668,
  57667,
  57597,
  57596,
  57590,
  57589,
  57588,
  57587,
  57586,
  57585,
  57488,
  57480,
  57452,
  57444,
  57435,
  57430,
  57417,
  57416,
  57404,
  57393,
  57387,
  57350,
  57349,
  57334,
  57270,
  57268,
  57267,
  57266,
  57246,
  57243,
  57228,
  57223,
  57206,
  57198,
  57195,
  57168,
  57145,
  57143,
  57121,
  57117,
  57115,
  57106,
  57105,
  57102,
  57100,
  57036,
  57035,
  57033,
  57032,
  57029,
  57028,
  57025,
  57024,
  57023,
  57022,
  57018,
  57017,
  57001,
  56996,
  56995,
  56992,
  56991,
  56989,
  56986,
  56985,
  56983,
  56982,
  56978,
  56975,
  56973,
  56972,
  56971,
  56970,
  56957,
  56956,
  56951,
  56945,
  56938,
  56933,
  56930,
  56927,
  56917,
  56916,
  56911,
  56910,
  56906,
  56901,
  56900,
  56899,
  56892,
  56885,
  56884,
  56883,
  56881,
  56880,
  56879,
  56874,
  56873,
  56871,
  56867,
  56865,
  56862,
  56861,
  56855,
  56853,
  56851,
  56850,
  56845,
  56844,
  56840,
  56839,
  56837,
  56836,
  56833,
  56829,
  56828,
  56827,
  56824,
  56805,
  56803,
  56788,
  56773,
  56494,
  56477,
  55188,
  55184,
  55183,
  55182,
  55179,
  55168,
  55164,
  55163,
  55159,
  55158,
  55157,
  55154,
  55153,
  55150,
  55147,
  55134,
  55119,
  55116,
  55112,
  55111,
  55110,
  55109,
  55105,
  55104,
  55103,
  55102,
  55101,
  55099,
  55098,
  55096,
  55093,
  55091,
  55090,
  55045,
  53533,
  53532,
  53531,
  53525,
  53524,
  53523,
  53522,
  53521,
  53516,
  53512,
  53511,
  53510,
  53509,
  53508,
  53507,
  53506,
  53505,
  53504,
  53440,
  53439,
  53438,
  53432,
  53417,
  53190,
  53189,
  53188,
  53187,
  53179,
  53178,
  53162,
  53102,
  53101,
  53071,
  53068,
  53067,
  53066,
  52885,
  52884,
  52883,
  52882,
  52872,
  52871,
  52870,
  52869,
  52868,
  52867,
  52866,
  52863,
  52862,
  52861,
  52860,
  52857,
  52856,
  52820,
  52819,
  52800,
  52799,
  52792,
  52791,
  52786,
  52785,
  52784,
  52662,
  52661,
  52660,
  52659,
  52564,
  52563,
  52555,
  52554,
  52553,
  52477,
  52476,
  52416,
  52415,
  52331,
  52259,
  52251,
  52250,
  52249,
  52248,
  52243,
  52226,
  52195,
  52182,
  52181,
  52124,
  52071,
  52069,
  52063,
  52053,
  52048,
  52044,
  52032,
  52026,
  52023,
  52019,
  52014,
  52003,
  52002,
  51942,
  51813,
  51787,
  51694,
  51547,
  51546,
  51545,
  51544,
  51543,
  51310,
  51309,
  51308,
  51307,
  51306,
  51303,
  51299,
  51287,
  51286,
  51285,
  51195,
  51180,
  51111,
  51098,
  51029,
  50989,
  50905,
  50380,
  50370,
  50353,
  50352,
  50347,
  50268,
  50267,
  50218,
  50216,
  50196,
  50192,
  50087,
  50084,
  49790,
  49771,
  49504,
  49478,
  49477,
  49268,
  49235,
  49234,
  49233,
  49232,
  49231,
  49230,
  49229,
  49228,
  49227,
  49224,
  49219,
  49218,
  49128,
  48974,
  48907,
  48904,
  48903,
  48785,
  48784,
  48783,
  48775,
  48774,
  48773,
  48769,
  48766,
  48762,
  48761,
  48760,
  48759,
  48758,
  48745,
  48740,
  47403,
  46466,
  46464,
  45120,
  45119,
  45113,
  45112,
  45079,
  45078,
  45076,
  43975,
  43745,
  43744,
  43742,
  43217,
  42987,
  42985,
  42974,
  42947,
  42946,
  42927,
  42926,
  42924,
  42923,
  42922,
  42921,
  42920,
  42915,
  42913,
  42910,
  42909,
  42908,
  42905,
  42904,
  42902,
  42901,
  42900,
  42897,
  42896,
  42895,
  42894,
  42893,
  42892,
  42891,
  42886,
  42885,
  42884,
  42883,
  42882,
  42879,
  42877,
  42876,
  42874,
  42872,
  42870,
  42869,
  42868,
  42867,
  42865,
  42861,
  42859,
  42858,
  42857,
  42856,
  42855,
  42853,
  42851,
  42850,
  42849,
  42848,
  42847,
  42846,
  42844,
  42842,
  42840,
  42839,
  42838,
  42837,
  42836,
  42833,
  42832,
  42831,
  42830,
  42825,
  42822,
  42787,
  42785,
  42784,
  42781,
  42780,
  42765,
  42764,
  42763,
  42762,
  42761,
  42760,
  42757,
  42629,
  41938,
  41936,
  41869,
  41867,
  41856,
  41559,
  41485,
  41418,
  41414,
  41413,
  40778,
  40774,
  40756,
  40749,
  40748,
  40744,
  40734,
  40724,
  40708,
  40707,
  40705,
  40703,
  40687,
  40678,
  40671,
  40666,
  40663,
  40662,
  40661,
  40652,
  40570,
  40563,
  40562,
  40544,
  40535,
  40532,
  40527,
  40523,
  40522,
  40511,
  40510,
  40508,
  40507,
  40504,
  40503,
  40497,
  40490,
  40485,
  40474,
  40470,
  40467,
  40462,
  40461,
  40460,
  40459,
  40456,
  40453,
  40450,
  40449,
  40441,
  40433,
  40432,
  40430,
  40429,
  40422,
  39240,
  39228,
  39224,
  39222,
  39215,
  39213,
  39209,
  39204,
  39186,
  39176,
  39169,
  39165,
  39162,
  39156,
  39155,
  39154,
  39153,
  39147,
  39136,
  39131,
  39130,
  39120,
  39118,
  39113,
  39109,
  39107,
  39102,
  39098,
  39097,
  39091,
  39086,
  39050,
  39047,
  39040,
  39031,
  39030,
  39024,
  39018,
  39017,
  39004,
  38997,
  38981,
  38956,
  38955,
  38944,
  38943,
  38939,
  38937,
  38935,
  38931,
  38925,
  38922,
  38919,
  38917,
  38907,
  38903,
  38901,
  38897,
  38895,
  38891,
  38890,
  38886,
  38885,
  38881,
  38879,
  38878,
  38877,
  38876,
  38875,
  38872,
  38869,
  38866,
  38864,
  38858,
  38857,
  38854,
  38853,
  38842,
  38840,
  38823,
  38818,
  38815,
  38813,
  38797,
  38792,
  38790,
  38783,
  38769,
  38758,
  38757,
  38747,
  36734,
  36710,
  36695,
  36694,
  36693,
  36673,
  36661,
  36636,
  36616,
  36585,
  36569,
  36550,
  36493,
  36492,
  36480,
  36477,
  36467,
  36445,
  36441,
  36435,
  36432,
  36420,
  36389,
  36381,
  36373,
  36372,
  36371,
  36368,
  36364,
  36361,
  36341,
  36340,
  36338,
  36333,
  36328,
  36326,
  36323,
  36322,
  35067,
  35066,
  35060,
  35002,
  34984,
  34970,
  34907,
  34893,
  34881,
  34861,
  34857,
  34790,
  34773,
  34722,
  34720,
  34696,
  34692,
  34664,
  34662,
  34655,
  34644,
  34643,
  34641,
  34638,
  34636,
  34635,
  34633,
  34630,
  34627,
  34620,
  34616,
  34612,
  34611,
  34608,
  34596,
  34595,
  34588,
  34582,
  34575,
  34569,
  34562,
  34558,
  34557,
  34553,
  34551,
  34547,
  34546,
  34543,
  34542,
  34538,
  34533,
  34528,
  34523,
  34521,
  34520,
  34519,
  34518,
  34516,
  34502,
  34501,
  34499,
  34495,
  34489,
  34477,
  34474,
  34464,
  34463,
  34461,
  34458,
  34452,
  34447,
  34444,
  34431,
  34428,
  34423,
  34418,
  34416,
  34412,
  34409,
  34408,
  34407,
  34400,
  34394,
  34392,
  34391,
  34379,
  34368,
  34364,
  34363,
  34352,
  34338,
  34113,
  34111,
  34098,
  34097,
  34091,
  34089,
  34088,
  34083,
  34082,
  34081,
  34079,
  34078,
  34075,
  34073,
  34071,
  34069,
  34067,
  34066,
  34065,
  34064,
  34060,
  34058,
  34055,
  34054,
  34051,
  34048,
  34047,
  34045,
  34043,
  34042,
  34041,
  34039,
  34037,
  34036,
  34035,
  34033,
  34032,
  34030,
  34027,
  34026,
  34023,
  34022,
  34021,
  34019,
  34016,
  34014,
  34013,
  34011,
  34009,
  34004,
  33924,
  33922,
  33921,
  33920,
  33919,
  33916,
  33909,
  33906,
  33899,
  33890,
  33888,
  33874,
  33850,
  33846,
  33845,
  33842,
  33840,
  33836,
  33828,
  33827,
  33823,
  33822,
  33820,
  33819,
  33818,
  33814,
  33813,
  33810,
  33809,
  33801,
  33796,
  33795,
  33792,
  33789,
  33788,
  33787,
  33779,
  33777,
  33775,
  33772,
  33771,
  33769,
  33768,
  33763,
  33760,
  33753,
  33751,
  33750,
  33742,
  33737,
  33735,
  33729,
  33723,
  33721,
  33720,
  33712,
  33217,
  33195,
  33188,
  33171,
  33162,
  33152,
  33150,
  33140,
  33138,
  33092,
  32671,
  32643,
  32640,
  32639,
  32638,
  32637,
  32636,
  32629,
  32624,
  32616,
  32613,
  32611,
  32608,
  32599,
  32598,
  32593,
  32590,
  32589,
  32588,
  32587,
  32569,
  32546,
  32535,
  32534,
  32527,
  32522,
  32515,
  32514,
  32506,
  32464,
  32463,
  32462,
  32460,
  32459,
  32458,
  32457,
  32456,
  32451,
  32450,
  32425,
  32059,
  32050,
  32035,
  32034,
  32013,
  32012,
  31276,
  31273,
  31151,
  31148,
  31129,
  31126,
  31125,
  31114,
  31112,
  31105,
  31065,
  30654,
  30544,
  30501,
  30500,
  30436,
  30389,
  30345,
  30329,
  30309,
  30220,
  30199,
  30098,
  30087,
  30083,
  29853,
  29060,
  29056,
  29051,
  29050,
  29049,
  29048,
  29047,
  29044,
  29043,
  29036,
  29035,
  29033,
  29029,
  29028,
  29027,
  29026,
  28936,
  28933,
  28932,
  28931,
  28929,
  28927,
  28925,
  28921,
  28918,
  28916,
  28915,
  28914,
  28911,
  28909,
  28908,
  28905,
  28903,
  28901,
  28900,
  28899,
  28898,
  28897,
  28894,
  28893,
  28888,
  28887,
  28885,
  28865,
  28863,
  28862,
  28860,
  28858,
  28840,
  28838,
  28837,
  28836,
  28835,
  28832,
  28830,
  28825,
  28824,
  28818,
  28817,
  28811,
  28810,
  28483,
  28482,
  28352,
  28351,
  28350,
  28349,
  28347,
  28346,
  28345,
  28343,
  28342,
  28341,
  28337,
  28336,
  28329,
  28328,
  28322,
  28320,
  28319,
  28228,
  28225,
  28219,
  28218,
  28206,
  28205,
  28155,
  28147,
  28135,
  28132,
  28127,
  28126,
  28120,
  28117,
  28112,
  28101,
  28100,
  28099,
  28096,
  28095,
  28094,
  28084,
  28082,
  28077,
  28076,
  28073,
  28070,
  28068,
  28067,
  28063,
  28062,
  28059,
  27641,
  27339,
  27326,
  27323,
  27321,
  27318,
  27313,
  27311,
  27306,
  27303,
  27301,
  27281,
  27271,
  27264,
  27262,
  27257,
  27255,
  27252,
  27241,
  27238,
  27236,
  27235,
  27211,
  27210,
  27209,
  27208,
  27207,
  27198,
  27196,
  27192,
  27189,
  27188,
  27186,
  27183,
  27179,
  27177,
  27176,
  27175,
  27174,
  27173,
  27172,
  27169,
  27163,
  27161,
  27159,
  27158,
  27148,
  27145,
  27144,
  27142,
  27140,
  27139,
  27137,
  27136,
  27134,
  27128,
  27124,
  27122,
  27120,
  27119,
  27118,
  27117,
  27116,
  27109,
  27106,
  27103,
  27097,
  27096,
  27094,
  27093,
  27092,
  27088,
  27086,
  27084,
  27082,
  27080,
  27079,
  27078,
  27077,
  27076,
  27074,
  27072,
  27071,
  27069,
  27068,
  27064,
  27062,
  27059,
  27054,
  27053,
  27051,
  27049,
  27047,
  27046,
  27045,
  27044,
  27043,
  27040,
  27039,
  27037,
  27035,
  27033,
  27029,
  27027,
  27026,
  27025,
  27023,
  27020,
  27019,
  27018,
  27017,
  27016,
  27014,
  27010,
  27009,
  27005,
  26997,
  26871,
  26868,
  26864,
  26862,
  26859,
  26844,
  26828,
  26818,
  26809,
  26808,
  26749,
  26745,
  26706,
  26696,
  26683,
  26681,
  26676,
  26608,
  26606,
  26599,
  26587,
  26586,
  26584,
  26583,
  26581,
  26577,
  26573,
  26571,
  26570,
  26569,
  26567,
  26566,
  26556,
  26554,
  26552,
  26550,
  26549,
  26546,
  26545,
  26542,
  26541,
  26537,
  26536,
  26535,
  26533,
  26532,
  26531,
  26525,
  26506,
  26505,
  26499,
  26497,
  26495,
  26494,
  26492,
  26488,
  26448,
  26393,
  26178,
  26177,
  26176,
  26173,
  26172,
  26171,
  26169,
  26167,
  26166,
  26165,
  26162,
  26160,
  26159,
  26151,
  26150,
  26148,
  26136,
  26106,
  26105,
  26085,
  26084,
  26083,
  26082,
  26079,
  26077,
  26074,
  26072,
  26071,
  26070,
  26064,
  26062,
  26061,
  26056,
  26050,
  26005,
  26004,
  26001,
  26000,
  25999,
  25983,
  25980,
  25979,
  25978,
  25937,
  25733,
  25732,
  25731,
  25730,
  25728,
  25723,
  25720,
  25716,
  25714,
  25713,
  25712,
  25711,
  25708,
  25643,
  25640,
  25634,
  25618,
  25614,
  25602,
  25601,
  25599,
  25594,
  25591,
  25590,
  25589,
  25588,
  25587,
  25585,
  25583,
  25578,
  25576,
  25572,
  25571,
  25570,
  25567,
  25563,
  25562,
  25477,
  25476,
  25467,
  25466,
  25412,
  24123,
  22894,
  19008,
  18990,
  18968,
  18964,
  18961,
  18945,
  18936,
  18934,
  18908,
  18871,
  18869,
  18865,
  18765,
  18762,
  18761,
  18759,
  18745,
  18694,
  18692,
  18691,
  18684,
  18658,
  18648,
  18645,
  18617,
  18611,
  18604,
  18593,
  18590,
  18583,
  18576,
  18575,
  18574,
  18570,
  18566,
  18550,
  18541,
  18536,
  18527,
  18491,
  18475,
  18470,
  18403,
  18400,
  18365,
  18358,
  18343,
  18340,
  18336,
  18324,
  18321,
  18310,
  18308,
  18307,
  18295,
  18265,
  18239,
  18223,
  18219,
  18217,
  18204,
  18155,
  18154,
  18125,
  18124,
  18076,
  18074,
  18058,
  18053,
  18031,
  18028,
  18022,
  18008,
  17993,
  17968,
  17957,
  17950,
  17946,
  17938,
  17932,
  17930,
  17928,
  17923,
  17910,
  17897,
  17894,
  17883,
  17874,
  17864,
  17840,
  17834,
  17815,
  17796,
  17717,
  17691,
  17677,
  17668,
  17665,
  17649,
  17647,
  17643,
  17633,
  17601,
  17598,
  17591,
  17584,
  17577,
  17571,
  17569,
  17567,
  17564,
  17549,
  17543,
  17542,
  17533,
  17506,
  17492,
  17476,
  17473,
  17424,
  17409,
  17407,
  17398,
  17393,
  17391,
  17389,
  17385,
  17335,
  17329,
  17285,
  17275,
  17270,
  17268,
  17261,
  17254,
  17253,
  17247,
  17243,
  17239,
  17234,
  17232,
  17224,
  17221,
  17215,
  17214,
  17211,
  17198,
  17188,
  17179,
  17176,
  17170,
  17161,
  17156,
  17151,
  17145,
  17141,
  17132,
  17131,
  17129,
  17110,
  17107,
  17100,
  17090,
  17087,
  17079,
  17071,
  17070,
  17066,
  17062,
  16993,
  16985,
  16969,
  16962,
  16960,
  16956,
  16937,
  16922,
  16917,
  16916,
  16886,
  16830,
  16823,
  16788,
  16782,
  16760,
  16753,
  16741,
  16740,
  16733,
  16726,
  16720,
  16718,
  16710,
  16709,
  16691,
  16687,
  16672,
  16671,
  16648,
  16644,
  16610,
  16604,
  16598,
  16596,
  16592,
  16591,
  16563,
  16560,
  16538,
  16532,
  16528,
  16525,
  16517,
  16496,
  16484,
  16481,
  16472,
  16470,
  16468,
  16445,
  16433,
  16430,
  16415,
  16414,
  16401,
  16390,
  16380,
  16367,
  16363,
  16352,
  16343,
  16334,
  16331,
  16321,
  16319,
  16312,
  16286,
  16276,
  16253,
  16169,
  16168,
  16165,
  16152,
  16120,
  16111,
  16085,
  16070,
  16060,
  16022,
  16004,
  15992,
  15968,
  15944,
  15928,
  15926,
  15906,
  15875,
  15867,
  15787,
  15773,
  15710,
  15702,
  15680,
  15644,
  15516,
  15427,
  15426,
  15397,
  15368,
  15367,
  15362,
  15361,
  15309,
  15289,
  15279,
  15272,
  15241,
  15224,
  15209,
  14623,
  13368,
  13318,
  11290,
  11116,
  10520,
  10519,
  10518,
  10447,
  10436,
  10411,
  10394,
  10386,
  10378,
  10337,
  10308,
  9042,
  9040,
  8701,
  8056,
  8055,
  8029,
  8002,
  7703,
  7537,
  7536,
  7535,
  7534,
  7531,
  6831,
  6830,
  6829,
  6828,
  6658,
  6434,
  5737,
  5734,
  5712,
  5618,
  5574,
  5570,
  5569,
  5563,
  5562,
  5494,
  5458,
  5457,
  5399,
  5301,
  5298,
  5297,
  5294,
  5291,
  5288,
  5284,
  5251,
  5234,
  5223,
  5218,
  5212,
  5204,
  5114,
  4990,
  4969,
  4946,
  4932,
  4931,
  4930,
  4928,
  4923,
  4920,
  4906,
  4904,
  4883,
  4882,
  4881,
  4880,
  4867,
  4866,
  4865,
  4863,
  4829,
  4774,
  4771,
  4766,
  4730,
  4509,
  4506,
  4495,
  4462,
  4461,
  4460,
  4459,
  4458,
  4457,
  4453,
  4452,
  4442,
  4426,
  4265,
  4258,
  4253,
  4244,
  4135,
  3937,
  3933,
  3930,
  3923,
  3882,
  3871,
  3850,
  3837,
  3813,
  3783,
  3473,
  3429,
  3428,
  3427,
  3373,
  3366,
  3359,
  3357,
  3354,
  2994,
  2982,
  2981,
  2534,
  2470,
  2458,
  2444,
  2197,
  1992,
  1990,
  1981,
  1859,
  1844,
  1601,
  1101,
  1075,
  625,
  623,
  152,
  139,
  121,
  96,
  75,
])